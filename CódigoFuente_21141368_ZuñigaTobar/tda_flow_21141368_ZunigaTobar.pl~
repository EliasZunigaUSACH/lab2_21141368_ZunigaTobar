% PARADIGMAS DE PROGRAMACIÓN LABORATORIO 2
% Nombre: Elías Zúñiga Tobar
% RUT: 21.141.368-9
% Profesor Gonzalo Matrinez
% TDA FLOW

:- module(tda_flow_21141368_ZunigaTobar, [getFlowId/2, getFlowsIds/3, filtroOptionsDuplicados/3, agregarOption/3, flow/4, flowAddOption/3, makeFlow/4]).
:- use_module(tda_option_21141368_ZunigaTobar).

% Regla: makeFlow
% Dominios: Id (Número) X NameMessage (String) X
% Meta Principal: makeFlow
% Meta Secundaria: Ninguna
% Descripción: Predicado constructor que crea el flujo, pero no
% tiene ningún filtro
makeFlow(Id, NameMessage, OptionsFiltrados, [Id, NameMessage, OptionsFiltrados]).

% Regla: getFlowId
% Dominios: Flow X Id (Número)
% Meta Principal: getFlowId
% Meta Secundaria: makeFlow(Id, _, _, Flow)
% Descripción: Predicado selector que obtiene la id de un flujo
getFlowId(Flow, Id):-
    makeFlow(Id, _, _, Flow).

% Regla: getFlowsIds
% Dominios: Flows X IdsAcc (Lista) X IdsSalida (Lista)
% Meta Principal: getFlowsIds
% Meta Secundaria: getFlowId(FlowCabeza, Id)
% Descripción: Predicado selector que obtiene las ids de un grupo de
% flujos
getFlowsIds([], IdsAcc, IdsAcc):- !.
getFlowsIds([FlowCabeza|FlowsCola], IdsAcc, IdsSalida):-
    getFlowId(FlowCabeza, Id),
    getFlowsIds(FlowsCola, [Id|IdsAcc], IdsSalida).

% Regla: filtroOptionsDuplicados
% Dominios: Flows X IdsAcc (Lista) X IdsSalida (Lista)
% Meta Principal: filtroOptionsDuplicados
% Meta Secundaria: getFlowId(FlowCabeza, Id)
% Descripción: Predicado constructor que filtra las opciones duplicadas
% para la construcción de un flujo
filtroOptionsDuplicados([], OptionsAcc, OptionsAcc):- !.
filtroOptionsDuplicados([OptionAgregar|RestoOptions], OptionsAcc, OptionsSalida):-
    getOptionId(OptionAgregar, Id),
    getOptionsIds(OptionsAcc, [], Ids),
    noPertenece(Id, Ids),
    filtroOptionsDuplicados(RestoOptions, [OptionAgregar|OptionsAcc], OptionsSalida).
filtroOptionsDuplicados([OptionAgregar|RestoOptions], OptionsAcc, OptionsSalida):-
    getOptionId(OptionAgregar, Id),
    getOptionsIds(OptionsAcc, [], Ids),
    pertenece(Id, Ids),
    filtroOptionsDuplicados(RestoOptions, OptionsAcc, OptionsSalida).

% Regla: agregarOption
% Dominios: NewOption X Options (Lista) X [NewOption|Options] (Lista)
% Meta Principal: agregarOption
% Meta Secundaria: getFlowId(FlowCabeza, Id)
% Descripción: Predicado constructor que crea una lista actualizada de
% opciones
agregarOption(NewOption, Options, [NewOption|Options]).

% Regla: flow
% Dominios:
% Meta Principal: flow
% Meta Secundaria: filtroOptionsDuplicados(Options, [],
% OptionsFiltrados), makeFlow(Id, NameMessage, optionsFiltrados, Flow)
% Descripción: Predicado constructor que crea
flow(Id, NameMessage, Options, Flow):-
    filtroOptionsDuplicados(Options, [], OptionsFiltrados),
    makeFlow(Id, NameMessage, OptionsFiltrados, Flow).

flowAddOption(Flow, NewOption, NewFlow):-
    makeFlow(Id, Message, Options, Flow),
    agregarOption(NewOption, Options, NewOptions),
    flow(Id, Message, NewOptions, NewFlow).
